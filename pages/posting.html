<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Posting</title>
    </head>

    <body>
        <form action="/postmessage" method="post">
            <label for="topic" style="font-size: 30px; font-weight: 500;">Topic:</label>
            <input type="text" name="topic" id="topic"><br><br>
            <label for="data" style="font-size: 30px; font-weight: 500;">Data:</label><br>
            <textarea name="data" cols="50" rows="5" id="data">Add Text</textarea><br>
            <button onclick="writeData()">Submit</button>
        </form><br><br>
        
        <label for="posts" style="font-size: 30px; font-weight: 500;">Posts:</label><br>
        <div id="container"></div><br><br>

        <script type="text/javascript">
            function displayPosts() {
                var http = new XMLHttpRequest();
                var url = '/';

                http.open('GET', url, true);
                
                http.onreadystatechange = function() {
                    if (http.readyState == 4 && http.status == 200) {
                        var response = JSON.parse(http.responseText);

                        const posts = document.getElementById("container");
                        posts.innerHTML = response; 
                    }
                };
                http.send();
                alert("Data was posted");
            }
            
            function writeData() {
                var posts = document.getElementById('container');
                var http = new XMLHttpRequest();
                var url = '/postmessage';

                http.open('POST', url, true);
                http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

                http.onreadystatechange = function() { 
                    if(http.readyState == 4 && http.status == 200) {
                        displayPosts();
                    }
                }
                alert("Data was written");
            }

            setTimeout(displayPosts(), 300000);

            displayPosts();
        </script>
    </body>
</html>